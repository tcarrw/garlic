<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Garlic Toast — Relax & Cook</title>
<meta name="description" content="Set toast level, use a gentle kitchen timer, relax with aroma steam. Optional Relaxation Pack, Hum Guide, Artist Mode. Local notes. No tracking." />
<meta name="referrer" content="no-referrer" />
<meta name="color-scheme" content="dark light" />
<style>
  :root{
    --bg:#0f0f10; --fg:#ececec; --muted:#a7a7ad; --ring:#2a2b31;
    --card:#16171a; --accent:#ffd26a; --accent2:#ff9f4a; --ok:#53e39b; --lav:#c9a7ff;
    --radius:16px; --shadow:0 10px 30px rgba(0,0,0,.35);
    --font: ui-rounded, system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial;
    --ringTint:#ffd26a;
  }
  @media (prefers-color-scheme:light){
    :root{ --bg:#fafafc; --fg:#1b1c20; --muted:#5b5d66; --card:#ffffff; --ring:#e6e7ee; --shadow:0 10px 30px rgba(0,0,0,.08) }
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{margin:0;background:radial-gradient(900px 540px at 70% -10%, rgba(255,159,74,.14), transparent 60%), var(--bg); color:var(--fg); font:16px/1.45 var(--font)}
  .wrap{max-width:760px;margin:auto;padding:24px}
  header{display:flex;justify-content:space-between;align-items:center;margin-bottom:14px;gap:10px;flex-wrap:wrap}
  h1{font-size:1.25rem;margin:0}
  .clock{border:1px solid var(--ring);padding:6px 10px;border-radius:999px;font-variant-numeric:tabular-nums;background:var(--card)}
  .card{background:var(--card);border:1px solid var(--ring);border-radius:var(--radius);box-shadow:var(--shadow);padding:16px;margin-top:16px}
  .sub{color:var(--muted);font-size:.92rem}
  .row{display:flex;gap:12px;align-items:center;justify-content:space-between;flex-wrap:wrap}
  .slider{appearance:none;width:100%;height:8px;border-radius:999px;background:linear-gradient(90deg,var(--accent),var(--accent2))}
  .slider::-webkit-slider-thumb{appearance:none;width:22px;height:22px;border-radius:50%;background:#fff;border:2px solid #0001;box-shadow:0 2px 8px rgba(0,0,0,.25)}
  .meter{font-variant-numeric:tabular-nums;font-weight:700}
  .btns{display:flex;gap:10px;flex-wrap:wrap}
  button{appearance:none;border:1px solid var(--ring);background:var(--card);color:var(--fg);padding:10px 14px;border-radius:12px;font-weight:600;cursor:pointer}
  button.primary{background:linear-gradient(180deg,rgba(255,210,106,.25),rgba(255,210,106,.1));border-color:#0000}
  textarea{width:100%;min-height:64px;border-radius:12px;border:1px solid var(--ring);padding:10px;background:var(--card);color:var(--fg)}
  .mono{font-family:ui-monospace,SFMono-Regular,Menlo,Consolas,monospace}
  .hint{font-size:.9rem;color:var(--muted)}
  .chips{display:flex;gap:8px;flex-wrap:wrap}
  .chip{padding:6px 10px;border-radius:999px;border:1px solid var(--ring);background:rgba(255,255,255,.02);cursor:pointer}
  .chip.hidden{display:none}
  .mutedline{border-top:1px solid var(--ring);margin:10px 0}
  .log-item{padding:8px 0;border-bottom:1px dashed var(--ring)}
  details summary{cursor:pointer;user-select:none}
  /* Aroma steam */
  .aroma{height:200px;border:1px solid var(--ring);border-radius:12px;overflow:hidden;background:linear-gradient(180deg,rgba(255,210,106,.08),transparent),#0c0c0f}
  canvas{display:block;width:100%;height:100%}
  /* Progress ring */
  .ringbox{display:flex;align-items:center;gap:12px}
  .ring{width:48px;height:48px;border-radius:50%;background:
    conic-gradient(var(--ringTint) 0% 0%, #333 0% 100%);
    display:grid;place-items:center;border:1px solid var(--ring)}
  .ring > span{font-size:.78rem;font-variant-numeric:tabular-nums}
  .artistline{margin-top:8px;font-size:.95rem}
  /* Water cue */
  .waterdot{width:10px;height:10px;border-radius:50%;background:#6ecbff;box-shadow:0 0 0 0 rgba(110,203,255,.0)}
  .blink{animation: blink 1.2s ease 1}
  @keyframes blink { 0%{box-shadow:0 0 0 0 rgba(110,203,255,.7)} 100%{box-shadow:0 0 0 12px rgba(110,203,255,0)} }
  .watercap{display:none;color:#6ecbff}
  .watercap.show{display:inline}
  select{appearance:none;border:1px solid var(--ring);background:var(--card);color:var(--fg);padding:8px 10px;border-radius:10px}
  /* Start preset card */
  .startline{margin-top:8px}
</style>
</head>
<body>
  <div class="wrap" role="application" aria-label="Garlic Toast — Relax & Cook">
    <header>
      <div>
        <h1>Garlic Toast</h1>
        <div class="sub">Cook calmly. Let the aroma do the relaxing.</div>
      </div>
      <div class="clock mono" id="clock">00:00</div>
    </header>

    <!-- Start preset -->
    <section class="card">
      <div class="row">
        <div>
          <div class="sub">one-tap start</div>
          <div class="hint startline">inhale 4 · exhale 6 — smell = your metronome.</div>
        </div>
        <div class="btns">
          <button id="startCalm" class="primary">Start 3-minute calm</button>
        </div>
      </div>
    </section>

    <!-- Artist Mode -->
    <section class="card">
      <div class="row">
        <div>
          <div class="sub">artist mode</div>
          <div class="hint">Tiny copy & color only—keeps the page simple.</div>
        </div>
        <div class="btns">
          <select id="artist">
            <option value="default">Default</option>
            <option value="marina">MARINA</option>
            <option value="sigrid">Sigrid</option>
            <option value="taylor">Taylor</option>
            <option value="abbey">Abbey</option>
          </select>
        </div>
      </div>
      <div class="artistline" id="artistLine">Smell the toast → soften jaw → feel your feet.</div>
    </section>

    <!-- Toast level -->
    <section class="card">
      <div class="row" aria-label="Toast level">
        <div>
          <div class="sub">toast level</div>
          <div class="chips" id="chips">
            <div class="chip" data-level="30">Light</div>
            <div class="chip" data-level="55">Gold</div>
            <div class="chip" data-level="80">Dark</div>
          </div>
        </div>
        <div class="meter mono" id="levelMeter">55%</div>
      </div>
      <input id="level" class="slider" type="range" min="0" max="100" value="55" aria-label="Toast level percentage" />
      <p class="hint">Tip: set <strong>Gold</strong> for jammy-garlic toast; go lighter for thin bread.</p>
    </section>

    <!-- Kitchen timer -->
    <section class="card">
      <div class="row">
        <div>
          <div class="sub">kitchen timer</div>
          <div class="mono" id="elapsed">00:00</div>
        </div>
        <div class="btns">
          <button id="start" class="primary">Start</button>
          <button id="pause" disabled>Pause</button>
          <button id="reset" disabled>Reset</button>
        </div>
      </div>
      <div class="row" style="margin-top:10px">
        <div class="sub">quick presets</div>
        <div class="btns">
          <button data-mins="2">2:00</button>
          <button data-mins="3">3:00</button>
          <button data-mins="4">4:00</button>
        </div>
        <div class="hint"><span class="waterdot" id="waterDot" title="Sip water"></span> <span id="waterCap" class="watercap">sip water</span></div>
      </div>
      <p class="hint">Breathe while it toasts: 4-sec inhale, 6-sec exhale. Smell = signal to relax.</p>
    </section>

    <!-- Relaxation Pack -->
    <section class="card">
      <div class="row">
        <div>
          <div class="sub">relaxation pack</div>
          <div class="hint">Tap a tool; a small ring guides the time.</div>
        </div>
        <div class="btns" id="toolsRow">
          <button class="chip" data-tool="breath">4–6 Breath</button>
          <button class="chip" data-tool="hum">Hum 20s</button>
          <button class="chip" data-tool="jaw">Jaw Drop 20s</button>
          <button class="chip" data-tool="ground">Ground 10s</button>
        </div>
      </div>
      <div class="row" style="margin-top:12px; align-items:center">
        <div class="ringbox">
          <div class="ring" id="ring"><span id="ringText">–</span></div>
          <div class="hint" id="cue">Choose a tool above.</div>
        </div>
        <div class="btns">
          <button id="humGuide">Hum Guide (A3)</button>
          <button id="tone">Enable Aroma Tone</button>
        </div>
      </div>
    </section>

    <!-- Aroma visual -->
    <section class="card">
      <div class="row">
        <div>
          <div class="sub">aroma visual</div>
          <p class="hint" style="margin:6px 0 0">Soft steam curls that drift with toast level.</p>
        </div>
      </div>
      <div class="aroma"><canvas id="steam"></canvas></div>
    </section>

    <!-- Ritual Note -->
    <section class="card">
      <div class="sub">ritual note</div>
      <p class="hint" style="margin:6px 0 8px">What did you cook? How did it feel? (Saved locally)</p>
      <textarea id="note" placeholder="e.g., jammy garlic on sourdough; smelled like a warm hug; calmer after 3 breaths."></textarea>
      <div class="btns" style="margin-top:8px">
        <button id="saveNote" class="primary">Save</button>
        <button id="archiveNote">Archive Entry</button>
        <span id="saveState" class="hint"></span>
      </div>
      <div class="mutedline"></div>
      <div class="sub" style="margin-bottom:6px">recent entries</div>
      <div id="recent"></div>
      <details style="margin-top:8px">
        <summary class="hint">See full log</summary>
        <div id="fulllog" style="margin-top:8px"></div>
      </details>
    </section>

    <!-- Share line -->
    <section class="card">
      <div class="sub">share line</div>
      <textarea id="share" readonly></textarea>
      <div class="btns" style="margin-top:8px">
        <button id="copy">Copy</button>
        <span id="copied" class="hint"></span>
      </div>
    </section>

    <footer>
      <div>No tracking · Referrer off</div>
      <div class="hint">Keyboard: <span class="mono">S</span> start/pause · <span class="mono">R</span> reset · <span class="mono">C</span> copy</div>
    </footer>
  </div>

<script>
(()=>{
  // ===== Utils =====
  const pad=n=>n<10?"0"+n:n;
  const fmt=ms=>{const s=Math.max(0,Math.floor(ms/1000));const m=Math.floor(s/60),sec=s%60;return `${pad(m)}:${pad(sec)}`};
  const nowClock=()=>{const d=new Date();return `${pad(d.getHours())}:${pad(d.getMinutes())}`};
  const stamp=()=> new Date().toISOString();

  // ===== Elements =====
  const clock=document.getElementById('clock');
  const artistSel=document.getElementById('artist');
  const artistLine=document.getElementById('artistLine');

  const level=document.getElementById('level');
  const levelMeter=document.getElementById('levelMeter');
  const chips=document.getElementById('chips');

  const elapsedEl=document.getElementById('elapsed');
  const startBtn=document.getElementById('start');
  const pauseBtn=document.getElementById('pause');
  const resetBtn=document.getElementById('reset');
  const startCalm=document.getElementById('startCalm');
  const waterDot=document.getElementById('waterDot');
  const waterCap=document.getElementById('waterCap');

  const share=document.getElementById('share');
  const copy=document.getElementById('copy');
  const copied=document.getElementById('copied');

  const toneBtn=document.getElementById('tone');
  const humGuideBtn=document.getElementById('humGuide');

  const toolsRow=document.getElementById('toolsRow');
  const ring=document.getElementById('ring');
  const ringText=document.getElementById('ringText');
  const cue=document.getElementById('cue');

  const noteEl=document.getElementById('note');
  const saveBtn=document.getElementById('saveNote');
  const archiveBtn=document.getElementById('archiveNote');
  const saveState=document.getElementById('saveState');
  const recentBox=document.getElementById('recent');
  const fullLogBox=document.getElementById('fulllog');

  // ===== Clock =====
  clock.textContent=nowClock();
  setInterval(()=>clock.textContent=nowClock(), 30_000);

  // ===== Artist Mode =====
  const artistMap = {
    default: { line: "Smell the toast → soften jaw → feel your feet.", tint: "#ffd26a" },
    marina:  { line: "soft mouth, brave heart.", tint: "#ffe8b8" },
    sigrid:  { line: "clear air, clear voice.", tint: "#aee1ff" },
    taylor:  { line: "little ritual before you write.", tint: "#c9a7ff" },
    abbey:   { line: "studio quiet: soft hum, light head nod.", tint: "#ffcc88" }
  };
  function applyArtist(v){
    const a = artistMap[v] || artistMap.default;
    artistLine.textContent = a.line;
    document.documentElement.style.setProperty('--ringTint', a.tint);
  }
  artistSel.addEventListener('change', ()=> applyArtist(artistSel.value));
  applyArtist(artistSel.value);

  // ===== Toast level =====
  function setLevel(v){ level.value=String(v); levelMeter.textContent=`${v}%`; updateShare(); }
  level.addEventListener('input', e=> setLevel(Number(e.target.value)));
  chips.addEventListener('click', e=>{
    const v=e.target?.getAttribute?.('data-level'); if(v){ setLevel(Number(v)); }
  });
  setLevel(Number(level.value||55));

  // ===== Timer (countdown or up) + water cue =====
  let running=false, startAt=0, elapsed=0, targetMs=0, raf=0, halfFired=false;
  function tick(){
    const t=performance.now();
    const ms = running ? elapsed + (t-startAt) : elapsed;
    const remaining = Math.max(0, targetMs ? (targetMs - ms) : 0);
    elapsedEl.textContent = targetMs ? fmt(remaining) : fmt(ms);
    updateShare(ms);

    if(targetMs && !halfFired && ms >= (targetMs/2)){
      halfFired=true; waterDot.classList.add('blink'); waterCap.classList.add('show');
      setTimeout(()=>{waterDot.classList.remove('blink'); waterCap.classList.remove('show');}, 1500);
    }

    if (targetMs && remaining<=0 && running){
      running=false; elapsed=targetMs; startBtn.textContent="Start"; pauseBtn.disabled=true;
      document.title="Toast ready ✨";
    } else {
      raf = running ? requestAnimationFrame(tick) : 0;
    }
  }
  function start(){
    if(running) return;
    running=true; startAt=performance.now(); startBtn.textContent="Running";
    pauseBtn.disabled=false; resetBtn.disabled=false; if(!raf) tick();
  }
  function pause(){ if(!running) return; running=false; elapsed += performance.now()-startAt; startBtn.textContent="Start"; }
  function reset(){
    running=false; elapsed=0; startAt=0; targetMs=0; elapsedEl.textContent="00:00";
    startBtn.textContent="Start"; pauseBtn.disabled=true; resetBtn.disabled=true; updateShare(0);
    document.title="Garlic Toast — Relax & Cook"; halfFired=false;
  }
  startBtn.addEventListener('click', ()=> running?pause():start());
  pauseBtn.addEventListener('click', pause);
  resetBtn.addEventListener('click', reset);
  document.querySelectorAll('[data-mins]').forEach(b=>{
    b.addEventListener('click', ()=>{
      targetMs=Number(b.getAttribute('data-mins'))*60*1000;
      reset(); start();
    });
  });

  // One-tap preset: Gold 55%, 3:00, Start + Hum 20s ring
  startCalm.addEventListener('click', ()=>{
    setLevel(55);
    targetMs=3*60*1000;
    reset(); // clear
    targetMs=3*60*1000;
    start();
    runTool('hum'); // prime hum 20s
  });

  document.addEventListener('keydown', e=>{
    const k=e.key.toLowerCase();
    if(k==='s'){ running?pause():start(); }
    if(k==='r'){ reset(); }
    if(k==='c'){ doCopy(); }
  });

  // ===== Share line =====
  function updateShare(ms){
    const time = typeof ms==='number' ? fmt(ms) : '00:00';
    share.value = `Garlic Toast — level (${level.value}%) · ${time} · https://garlic.plnt.earth`;
  }
  updateShare(0);
  async function doCopy(){
    try{ await navigator.clipboard.writeText(share.value); copied.textContent="Copied ✓"; setTimeout(()=>copied.textContent="",1200); } catch {}
  }
  copy.addEventListener('click', doCopy);

  // ===== Aroma steam canvas (reduced-motion aware) =====
  const prefersReduced = window.matchMedia && window.matchMedia('(prefers-reduced-motion: reduce)').matches;
  const cvs=document.getElementById('steam'); const ctx=cvs.getContext('2d');
  let t0=0;
  function draw(ts){
    if(!t0) t0=ts;
    const t=(ts-t0)/1000, dpr=window.devicePixelRatio||1;
    const w=cvs.width=cvs.clientWidth*dpr, h=cvs.height=cvs.clientHeight*dpr;
    ctx.clearRect(0,0,w,h);
    const baseGrad=ctx.createLinearGradient(0,h,0,0);
    baseGrad.addColorStop(0,'#0b0b0d'); baseGrad.addColorStop(1,'#111218');
    ctx.fillStyle=baseGrad; ctx.fillRect(0,0,w,h);

    const levelF = Number(level.value)/100;
    const curls = 3;
    for(let i=0;i<curls;i++){
      const ampBase = prefersReduced ? 4 : 6;
      const amp = (ampBase + i*4) * dpr * (0.8 + levelF*0.6);
      const spBase = prefersReduced ? 0.08 : 0.2;
      const speed = (spBase + i*0.05) * (0.6 + levelF*0.8);
      const y0 = h*0.75 - i*35*dpr;
      ctx.beginPath();
      for(let x=0;x<=w;x+=6*dpr){
        const y=y0 - Math.sin((x*0.004 + t*speed) + i)*amp - (t*(prefersReduced?2.5:5));
        if(x===0) ctx.moveTo(x,y); else ctx.lineTo(x,y);
      }
      ctx.strokeStyle = `hsla(${40+i*20} 90% ${60+(i*5)}% / ${0.35 + levelF*0.25})`;
      ctx.lineWidth=3*dpr; ctx.stroke();
    }
    requestAnimationFrame(draw);
  }
  requestAnimationFrame(draw);

  // ===== Audio (Aroma 128 Hz + Hum Guide 220 Hz, auto-fade) =====
  let ac=null, toneOsc=null, toneGain=null, humOsc=null, humGain=null, toneFadeTimer=null;
  function ensureAudio(){
    if(!ac){
      ac = new (window.AudioContext||window.webkitAudioContext)();
      // Aroma tone
      toneGain = ac.createGain(); toneGain.gain.value=0.0; toneGain.connect(ac.destination);
      toneOsc = ac.createOscillator(); toneOsc.type="sine"; toneOsc.frequency.value=128; toneOsc.connect(toneGain); toneOsc.start();
      // Hum guide
      humGain = ac.createGain(); humGain.gain.value=0.0; humGain.connect(ac.destination);
      humOsc = ac.createOscillator(); humOsc.type="sine"; humOsc.frequency.value=220; humOsc.connect(humGain); humOsc.start();
    }
  }
  toneBtn.addEventListener('click', async ()=>{
    ensureAudio(); if(ac.state==="suspended"){ try{ await ac.resume(); }catch{} }
    const on = toneGain.gain.value>0.0001;
    if(on){
      toneGain.gain.linearRampToValueAtTime(0.0,(ac.currentTime||0)+0.06);
      toneBtn.textContent = "Enable Aroma Tone";
      if(toneFadeTimer) clearTimeout(toneFadeTimer);
    }else{
      // enable and schedule auto-fade to 0.03 after 15s
      toneGain.gain.linearRampToValueAtTime(0.06,(ac.currentTime||0)+0.06);
      toneBtn.textContent = "Disable Aroma Tone";
      if(toneFadeTimer) clearTimeout(toneFadeTimer);
      toneFadeTimer = setTimeout(()=>{
        if(ac && toneGain && toneGain.gain.value>0.0001){
          toneGain.gain.linearRampToValueAtTime(0.03, (ac.currentTime||0)+0.5);
        }
      }, 15000);
    }
  });
  humGuideBtn.addEventListener('click', async ()=>{
    ensureAudio(); if(ac.state==="suspended"){ try{ await ac.resume(); }catch{} }
    const on = humGain.gain.value>0.0001;
    humGain.gain.linearRampToValueAtTime(on?0.0:0.07,(ac.currentTime||0)+0.04);
    humGuideBtn.textContent = on? "Hum Guide (A3)" : "Stop Hum Guide";
  });

  // ===== Relaxation Pack (ring timer + chip hiding) =====
  let ringTimer=null, ringEnd=0, ringActive=false, activeTool=null;
  function setRing(pct, label){
    ring.style.background = `conic-gradient(var(--ringTint) 0% ${pct}%, #333 ${pct}% 100%)`;
    ringText.textContent = label || "–";
  }
  function hideOtherChips(hide){
    const nodes = Array.from(toolsRow.querySelectorAll('.chip'));
    nodes.forEach(n=>{
      if(!activeTool || n.textContent.trim().toLowerCase().includes(activeTool)) return;
      n.classList.toggle('hidden', hide);
    });
  }
  function startRing(seconds, text, toolKey){
    clearRing();
    ringActive=true; activeTool = toolKey || null;
    hideOtherChips(true);
    ringEnd = performance.now() + seconds*1000;
    cue.textContent = text;
    tickRing();
  }
  function tickRing(){
    if(!ringActive) return;
    const now = performance.now();
    const remaining = Math.max(0, ringEnd - now);
    const total = Math.max(1, (ringEnd - (ringEnd - remaining)));
    const pct = Math.max(0, 100 - (remaining / total)*100);
    setRing(pct, Math.ceil(remaining/1000)+"s");
    if(remaining<=0){ clearRing(); return; }
    ringTimer = requestAnimationFrame(tickRing);
  }
  function clearRing(){
    ringActive=false; activeTool=null;
    if(ringTimer) cancelAnimationFrame(ringTimer);
    setRing(0,"–"); cue.textContent="Choose a tool above.";
    hideOtherChips(false);
  }
  function runTool(key){
    if(key==="breath"){ startRing(60, "Inhale 4 · Exhale 6 — slow and easy.", "breath"); }
    else if(key==="hum"){ startRing(20, "Hum softly (mmm), jaw loose.", "hum"); }
    else if(key==="jaw"){ startRing(20, "Tongue rests low; jaw unhooks.", "jaw"); }
    else if(key==="ground"){ startRing(10, "Notice scent → feel feet.", "ground"); }
  }
  toolsRow.querySelectorAll('[data-tool]').forEach(b=>{
    b.addEventListener('click', ()=> runTool(b.getAttribute('data-tool')));
  });

  // ===== Ritual Note (localStorage) =====
  const NOTE_KEY = 'garlic.ritual.note';
  const LOG_KEY  = 'garlic.ritual.log';
  noteEl.value = localStorage.getItem(NOTE_KEY) || '';
  function setSaveState(msg){ saveState.textContent = msg; setTimeout(()=>{ if(saveState.textContent===msg) saveState.textContent=''; }, 1200); }
  let saveTimer=null;
  function autoSave(){
    if(saveTimer) clearTimeout(saveTimer);
    saveTimer=setTimeout(()=>{
      localStorage.setItem(NOTE_KEY, noteEl.value);
      setSaveState('Saved ✓'); renderRecent();
    }, 400);
  }
  noteEl.addEventListener('input', autoSave);
  saveBtn.addEventListener('click', ()=>{ localStorage.setItem(NOTE_KEY, noteEl.value); setSaveState('Saved ✓'); renderRecent(); });
  archiveBtn.addEventListener('click', ()=>{
    const text = (noteEl.value||'').trim();
    if(!text){ setSaveState('Nothing to archive'); return; }
    const entry = { ts: stamp(), level: Number(level.value), text };
    const log = JSON.parse(localStorage.getItem(LOG_KEY) || '[]'); log.unshift(entry);
    localStorage.setItem(LOG_KEY, JSON.stringify(log));
    localStorage.setItem(NOTE_KEY, ''); noteEl.value='';
    setSaveState('Archived ✓'); renderRecent(); renderFull();
  });
  function escapeHtml(s){ return s.replace(/[&<>"']/g, m=>({ '&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;' }[m])); }
  function renderRecent(){
    const log = JSON.parse(localStorage.getItem(LOG_KEY) || '[]');
    recentBox.innerHTML = log.slice(0,5).map(item=>{
      const d = new Date(item.ts);
      return `<div class="log-item">
        <div class="mono">${d.toLocaleString()}</div>
        <div class="hint">level ${item.level}%</div>
        <div>${escapeHtml(item.text).replace(/\n/g,'<br>')}</div>
      </div>`;
    }).join('') || `<div class="hint">No entries yet.</div>`;
  }
  function renderFull(){
    const log = JSON.parse(localStorage.getItem(LOG_KEY) || '[]');
    fullLogBox.innerHTML = log.map(item=>{
      const d = new Date(item.ts);
      return `<div class="log-item">
        <div class="mono">${d.toLocaleString()}</div>
        <div class="hint">level ${item.level}%</div>
        <div>${escapeHtml(item.text).replace(/\n/g,'<br>')}</div>
      </div>`;
    }).join('') || `<div class="hint">Log is empty.</div>`;
  }
  renderRecent(); renderFull();

  // ===== Init =====
  updateShare(0);
})();
</script>
</body>
</html>
