<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Garlic Toast — Relax & Cook</title>
<meta name="description" content="Set your toast level, run a kitchen timer, relax with a gentle aroma visual, and write a quick ritual note. Local-only, no tracking." />
<meta name="referrer" content="no-referrer" />
<meta name="color-scheme" content="dark light" />
<style>
  :root{
    --bg:#0f0f10; --fg:#ececec; --muted:#a7a7ad; --ring:#2a2b31;
    --card:#16171a; --accent:#ffd26a; --accent2:#ff9f4a; --ok:#53e39b;
    --radius:16px; --shadow:0 10px 30px rgba(0,0,0,.35);
    --font: ui-rounded, system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial;
  }
  @media (prefers-color-scheme:light){
    :root{ --bg:#fafafc; --fg:#1b1c20; --muted:#5b5d66; --card:#ffffff; --ring:#e6e7ee; --shadow:0 10px 30px rgba(0,0,0,.08) }
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{margin:0;background:radial-gradient(1000px 600px at 70% -10%, rgba(255,159,74,.15), transparent 60%), var(--bg); color:var(--fg); font:16px/1.45 var(--font)}
  .wrap{max-width:760px;margin:auto;padding:24px}
  header{display:flex;justify-content:space-between;align-items:center;margin-bottom:14px}
  h1{font-size:1.25rem;margin:0}
  .clock{border:1px solid var(--ring);padding:6px 10px;border-radius:999px;font-variant-numeric:tabular-nums;background:var(--card)}
  .card{background:var(--card);border:1px solid var(--ring);border-radius:var(--radius);box-shadow:var(--shadow);padding:16px;margin-top:16px}
  .sub{color:var(--muted);font-size:.92rem}
  .row{display:flex;gap:12px;align-items:center;justify-content:space-between;flex-wrap:wrap}
  .slider{appearance:none;width:100%;height:8px;border-radius:999px;background:linear-gradient(90deg,var(--accent),var(--accent2))}
  .slider::-webkit-slider-thumb{appearance:none;width:22px;height:22px;border-radius:50%;background:#fff;border:2px solid #0001;box-shadow:0 2px 8px rgba(0,0,0,.25)}
  .meter{font-variant-numeric:tabular-nums;font-weight:700}
  .btns{display:flex;gap:10px;flex-wrap:wrap}
  button{appearance:none;border:1px solid var(--ring);background:var(--card);color:var(--fg);padding:10px 14px;border-radius:12px;font-weight:600;cursor:pointer}
  button.primary{background:linear-gradient(180deg,rgba(255,210,106,.25),rgba(255,210,106,.1));border-color:#0000}
  textarea{width:100%;min-height:64px;border-radius:12px;border:1px solid var(--ring);padding:10px;background:var(--card);color:var(--fg)}
  .mono{font-family:ui-monospace,SFMono-Regular,Menlo,Consolas,monospace}
  .hint{font-size:.9rem;color:var(--muted)}
  /* Aroma steam canvas */
  .aroma{height:200px;border:1px solid var(--ring);border-radius:12px;overflow:hidden;background:linear-gradient(180deg,rgba(255,210,106,.08),transparent),#0c0c0f}
  canvas{display:block;width:100%;height:100%}
  .chips{display:flex;gap:8px;flex-wrap:wrap}
  .chip{padding:6px 10px;border-radius:999px;border:1px solid var(--ring);background:rgba(255,255,255,.02);cursor:pointer}
  .mutedline{border-top:1px solid var(--ring);margin:10px 0}
  .log-item{padding:8px 0;border-bottom:1px dashed var(--ring)}
  details summary{cursor:pointer;user-select:none}
  footer{margin-top:16px;color:var(--muted);font-size:.9rem;display:flex;justify-content:space-between;gap:10px;flex-wrap:wrap}
</style>
</head>
<body>
  <div class="wrap" role="application" aria-label="Garlic Toast — Relax & Cook">
    <header>
      <div>
        <h1>Garlic Toast</h1>
        <div class="sub">Cook calmly. Let the aroma do the relaxing.</div>
      </div>
      <div class="clock mono" id="clock">00:00</div>
    </header>

    <!-- Toast level -->
    <section class="card">
      <div class="row" aria-label="Toast level">
        <div>
          <div class="sub">toast level</div>
          <div class="chips" id="chips">
            <div class="chip" data-level="30">Light</div>
            <div class="chip" data-level="55">Gold</div>
            <div class="chip" data-level="80">Dark</div>
          </div>
        </div>
        <div class="meter mono" id="levelMeter">55%</div>
      </div>
      <input id="level" class="slider" type="range" min="0" max="100" value="55" aria-label="Toast level percentage" />
      <p class="hint">Tip: set <strong>Gold</strong> for jammy-garlic toast; go lighter if your bread is thin.</p>
    </section>

    <!-- Kitchen timer -->
    <section class="card">
      <div class="row">
        <div>
          <div class="sub">kitchen timer</div>
          <div class="mono" id="elapsed">00:00</div>
        </div>
        <div class="btns">
          <button id="start" class="primary">Start</button>
          <button id="pause" disabled>Pause</button>
          <button id="reset" disabled>Reset</button>
        </div>
      </div>
      <div class="row" style="margin-top:10px">
        <div class="sub">quick presets</div>
        <div class="btns">
          <button data-mins="2">2:00</button>
          <button data-mins="3">3:00</button>
          <button data-mins="4">4:00</button>
        </div>
      </div>
      <p class="hint">Breathe while it toasts: 4-sec inhale, 6-sec exhale. Smell = signal to relax.</p>
    </section>

    <!-- Aroma visual + tone -->
    <section class="card">
      <div class="row">
        <div>
          <div class="sub">aroma visual</div>
          <p class="hint" style="margin:6px 0 0">Soft steam curls that drift with your toast level.</p>
        </div>
        <div class="btns">
          <button id="tone">Enable Aroma Tone</button>
        </div>
      </div>
      <div class="aroma"><canvas id="steam"></canvas></div>
    </section>

    <!-- Ritual Note -->
    <section class="card">
      <div class="row">
        <div>
          <div class="sub">ritual note</div>
          <p class="hint" style="margin:6px 0 0">What did you cook? How did it feel? (Saved locally)</p>
        </div>
      </div>
      <textarea id="note" placeholder="e.g., jammy garlic on sourdough; smelled like a warm hug; felt calmer after 3 breaths."></textarea>
      <div class="btns" style="margin-top:8px">
        <button id="saveNote" class="primary">Save</button>
        <button id="archiveNote">Archive Entry</button>
        <span id="saveState" class="hint"></span>
      </div>
      <div class="mutedline"></div>
      <div class="sub" style="margin-bottom:6px">recent entries</div>
      <div id="recent"></div>
      <details style="margin-top:8px">
        <summary class="hint">See full log</summary>
        <div id="fulllog" style="margin-top:8px"></div>
      </details>
    </section>

    <!-- Share line -->
    <section class="card">
      <div class="sub">share line</div>
      <textarea id="share" readonly></textarea>
      <div class="btns" style="margin-top:8px">
        <button id="copy">Copy</button>
        <span id="copied" class="hint"></span>
      </div>
    </section>

    <footer>
      <div>No tracking · Referrer off</div>
      <div class="hint">Keyboard: <span class="mono">S</span> start/pause · <span class="mono">R</span> reset · <span class="mono">C</span> copy</div>
    </footer>
  </div>

<script>
(()=>{
  // ===== Utils =====
  const pad=n=>n<10?"0"+n:n;
  const fmt=ms=>{const s=Math.max(0,Math.floor(ms/1000));const m=Math.floor(s/60),sec=s%60;return `${pad(m)}:${pad(sec)}`};
  const nowClock=()=>{const d=new Date();return `${pad(d.getHours())}:${pad(d.getMinutes())}`};
  const stamp=()=> new Date().toISOString();

  // ===== Elements =====
  const level=document.getElementById('level');
  const levelMeter=document.getElementById('levelMeter');
  const chips=document.getElementById('chips');
  const elapsedEl=document.getElementById('elapsed');
  const startBtn=document.getElementById('start');
  const pauseBtn=document.getElementById('pause');
  const resetBtn=document.getElementById('reset');
  const share=document.getElementById('share');
  const copy=document.getElementById('copy');
  const copied=document.getElementById('copied');
  const clock=document.getElementById('clock');
  const toneBtn=document.getElementById('tone');

  const noteEl=document.getElementById('note');
  const saveBtn=document.getElementById('saveNote');
  const archiveBtn=document.getElementById('archiveNote');
  const saveState=document.getElementById('saveState');
  const recentBox=document.getElementById('recent');
  const fullLogBox=document.getElementById('fulllog');

  // ===== Clock =====
  clock.textContent=nowClock();
  setInterval(()=>clock.textContent=nowClock(), 30_000);

  // ===== Toast level =====
  function setLevel(v){ level.value=String(v); levelMeter.textContent=`${v}%`; updateShare(); }
  level.addEventListener('input', e=> setLevel(Number(e.target.value)));
  chips.addEventListener('click', e=>{
    const v=e.target?.getAttribute?.('data-level'); if(v){ setLevel(Number(v)); }
  });
  setLevel(Number(level.value||55));

  // ===== Timer (countdown or up) =====
  let running=false, startAt=0, elapsed=0, targetMs=0, raf=0;
  function tick(){
    const t=performance.now();
    const ms = running ? elapsed + (t-startAt) : elapsed;
    const remaining = Math.max(0, targetMs ? (targetMs - ms) : 0);
    elapsedEl.textContent = targetMs ? fmt(remaining) : fmt(ms);
    updateShare(ms);
    if (targetMs && remaining<=0 && running){
      running=false; elapsed=targetMs; startBtn.textContent="Start"; pauseBtn.disabled=true;
      document.title="Toast ready ✨";
    } else {
      raf = running ? requestAnimationFrame(tick) : 0;
    }
  }
  function start(){
    if(running) return;
    running=true; startAt=performance.now(); startBtn.textContent="Running";
    pauseBtn.disabled=false; resetBtn.disabled=false; if(!raf) tick();
  }
  function pause(){ if(!running) return; running=false; elapsed += performance.now()-startAt; startBtn.textContent="Start"; }
  function reset(){
    running=false; elapsed=0; startAt=0; targetMs=0; elapsedEl.textContent="00:00";
    startBtn.textContent="Start"; pauseBtn.disabled=true; resetBtn.disabled=true; updateShare(0);
    document.title="Garlic Toast — Relax & Cook";
  }
  startBtn.addEventListener('click', ()=> running?pause():start());
  pauseBtn.addEventListener('click', pause);
  resetBtn.addEventListener('click', reset);
  document.querySelectorAll('[data-mins]').forEach(b=>{
    b.addEventListener('click', ()=>{
      targetMs=Number(b.getAttribute('data-mins'))*60*1000;
      reset(); start();
    });
  });
  document.addEventListener('keydown', e=>{
    const k=e.key.toLowerCase();
    if(k==='s'){ running?pause():start(); }
    if(k==='r'){ reset(); }
    if(k==='c'){ doCopy(); }
  });

  // ===== Share line =====
  function updateShare(ms){
    const time = typeof ms==='number' ? fmt(ms) : '00:00';
    share.value = `Garlic Toast — level (${level.value}%) · ${time} · https://garlic.plnt.earth`;
  }
  updateShare(0);
  async function doCopy(){
    try{ await navigator.clipboard.writeText(share.value); copied.textContent="Copied ✓"; setTimeout(()=>copied.textContent="",1200); } catch {}
  }
  copy.addEventListener('click', doCopy);

  // ===== Aroma steam canvas =====
  const cvs=document.getElementById('steam'); const ctx=cvs.getContext('2d');
  let t0=0;
  function draw(ts){
    if(!t0) t0=ts;
    const t=(ts-t0)/1000, dpr=window.devicePixelRatio||1;
    const w=cvs.width=cvs.clientWidth*dpr, h=cvs.height=cvs.clientHeight*dpr;
    ctx.clearRect(0,0,w,h);
    const baseGrad=ctx.createLinearGradient(0,h,0,0);
    baseGrad.addColorStop(0,'#0b0b0d'); baseGrad.addColorStop(1,'#111218');
    ctx.fillStyle=baseGrad; ctx.fillRect(0,0,w,h);

    const levelF = Number(level.value)/100;
    const curls = 3;
    for(let i=0;i<curls;i++){
      const amp = (6 + i*4) * dpr * (0.8 + levelF*0.6);
      const speed = (0.2 + i*0.05) * (0.6 + levelF*0.8);
      const y0 = h*0.75 - i*35*dpr;
      ctx.beginPath();
      for(let x=0;x<=w;x+=6*dpr){
        const y=y0 - Math.sin((x*0.004 + t*speed) + i)*amp - (t*5);
        if(x===0) ctx.moveTo(x,y); else ctx.lineTo(x,y);
      }
      ctx.strokeStyle = `hsla(${40+i*20} 90% ${60+(i*5)}% / ${0.35 + levelF*0.25})`;
      ctx.lineWidth=3*dpr; ctx.stroke();
    }
    requestAnimationFrame(draw);
  }
  requestAnimationFrame(draw);

  // ===== Aroma tone (gentle, optional) =====
  let ac=null, osc=null, gain=null, toneOn=false;
  function ensureAudio(){
    if(!ac){
      ac = new (window.AudioContext||window.webkitAudioContext)();
      gain = ac.createGain(); gain.gain.value=0.0; gain.connect(ac.destination);
      osc = ac.createOscillator(); osc.type="sine"; osc.frequency.value=128; osc.connect(gain); osc.start();
    }
  }
  toneBtn.addEventListener('click', async ()=>{
    ensureAudio();
    if(ac.state==="suspended"){ try{ await ac.resume(); }catch{} }
    toneOn=!toneOn;
    const target = toneOn? 0.05 : 0.0;
    gain.gain.linearRampToValueAtTime(target,(ac.currentTime||0)+0.08);
    toneBtn.textContent = toneOn? "Disable Aroma Tone" : "Enable Aroma Tone";
  });

  // ===== Ritual Note (localStorage) =====
  const NOTE_KEY = 'garlic.ritual.note';
  const LOG_KEY  = 'garlic.ritual.log';
  // load current note
  noteEl.value = localStorage.getItem(NOTE_KEY) || '';
  function setSaveState(msg){ saveState.textContent = msg; setTimeout(()=>{ if(saveState.textContent===msg) saveState.textContent=''; }, 1200); }

  // debounce auto-save
  let saveTimer=null;
  function autoSave(){
    if(saveTimer) clearTimeout(saveTimer);
    saveTimer=setTimeout(()=>{
      localStorage.setItem(NOTE_KEY, noteEl.value);
      setSaveState('Saved ✓');
      renderRecent();
    }, 400);
  }
  noteEl.addEventListener('input', autoSave);

  saveBtn.addEventListener('click', ()=>{
    localStorage.setItem(NOTE_KEY, noteEl.value);
    setSaveState('Saved ✓');
    renderRecent();
  });

  archiveBtn.addEventListener('click', ()=>{
    const text = (noteEl.value||'').trim();
    if(!text){ setSaveState('Nothing to archive'); return; }
    const entry = { ts: stamp(), level: Number(level.value), text };
    const log = JSON.parse(localStorage.getItem(LOG_KEY) || '[]');
    log.unshift(entry);
    localStorage.setItem(LOG_KEY, JSON.stringify(log));
    // clear current note (but keep a backup)
    localStorage.setItem(NOTE_KEY, '');
    noteEl.value='';
    setSaveState('Archived ✓');
    renderRecent();
    renderFull();
  });

  function renderRecent(){
    const log = JSON.parse(localStorage.getItem(LOG_KEY) || '[]');
    recentBox.innerHTML = log.slice(0,5).map(item=>{
      const d = new Date(item.ts);
      return `<div class="log-item">
        <div class="mono">${d.toLocaleString()}</div>
        <div class="hint">level ${item.level}%</div>
        <div>${escapeHtml(item.text).replace(/\n/g,'<br>')}</div>
      </div>`;
    }).join('') || `<div class="hint">No entries yet.</div>`;
  }
  function renderFull(){
    const log = JSON.parse(localStorage.getItem(LOG_KEY) || '[]');
    fullLogBox.innerHTML = log.map(item=>{
      const d = new Date(item.ts);
      return `<div class="log-item">
        <div class="mono">${d.toLocaleString()}</div>
        <div class="hint">level ${item.level}%</div>
        <div>${escapeHtml(item.text).replace(/\n/g,'<br>')}</div>
      </div>`;
    }).join('') || `<div class="hint">Log is empty.</div>`;
  }
  function escapeHtml(s){ return s.replace(/[&<>"']/g, m=>({ '&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;' }[m])); }

  renderRecent(); renderFull();

  // ===== Keyboard shortcuts =====
  document.addEventListener('keydown', e=>{
    const k=e.key.toLowerCase();
    if(k==='s'){ running?pause():start(); }
    if(k==='r'){ reset(); }
    if(k==='c'){ doCopy(); }
  });
})();
</script>
</body>
</html>
